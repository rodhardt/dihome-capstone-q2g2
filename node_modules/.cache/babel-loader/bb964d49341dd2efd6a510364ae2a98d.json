{"ast":null,"code":"var _jsxFileName = \"/home/rodhardt/Documents/Q2/new-dihome/dihome-capstone-q2g2/src/providers/Authentication/index.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport { createContext, useContext, useState } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport api from \"../../services/api\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext({});\nexport const AuthProvider = ({\n  children\n}) => {\n  _s();\n\n  const history = useHistory();\n  const [authToken, setAuthToken] = useState(() => localStorage.getItem(\"@dihome:token\") || \"\");\n  const [userId, setUserId] = useState(() => localStorage.getItem(\"@dihome:id\") || \"\");\n  const [userInfo, setUserInfo] = useState({});\n  const [previousPage, setPreviousPage] = useState(\"/\");\n\n  const authenticate = () => {\n    if (authToken !== \"\") {\n      api.get(`/users/${userId}`, {\n        headers: {\n          Authorization: `Bearer ${authToken}`\n        }\n      }).then(response => {\n        setUserInfo(response.data);\n      }).catch(err => console.log(err));\n    }\n\n    if (history.location.pathname === \"/perfil\" && authToken === \"\") {\n      setPreviousPage(\"/perfil\");\n      history.push(\"/login\");\n    }\n  };\n\n  const returnPreviousPage = () => {\n    history.push(previousPage);\n  };\n\n  const signIn = userSignInData => {\n    api.post(\"/signin\", userSignInData).then(response => {\n      localStorage.setItem(\"@dihome:token\", response.data.accessToken);\n      localStorage.setItem(\"@dihome:id\", response.data.user.id);\n      setAuthToken(response.data.accessToken);\n      setUserInfo(response.data.user);\n      setUserId(response.data.user.id);\n      history.push(previousPage);\n    }).catch(err => console.log(err));\n  };\n\n  const registerUser = userData => {\n    api.post(\"/register\", userData).then(response => {\n      localStorage.setItem(\"@dihome:token\", response.data.accessToken);\n      localStorage.setItem(\"@dihome:id\", response.data.user.id);\n      setAuthToken(response.data.accessToken);\n      setUserInfo(response.data.user);\n      setUserId(response.data.user.id);\n      history.push(previousPage);\n    }).catch(err => console.log(err));\n  };\n\n  const logout = () => {\n    localStorage.clear();\n    setAuthToken(\"\");\n    setUserInfo({});\n    history.push(\"/\");\n  };\n\n  const updateUser = newUserData => {\n    console.log(newUserData);\n    console.log(authToken);\n    console.log(userId);\n    setUserInfo(newUserData);\n    api.patch(`/users/${userId}`, newUserData, {\n      headers: {\n        Authorization: `Bearer ${authToken}`\n      }\n    }).catch(err => console.log(err));\n  };\n\n  const registerPreviousPage = () => {\n    setPreviousPage(`${history.location.pathname}`);\n  };\n\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      authToken,\n      userInfo,\n      authenticate,\n      signIn,\n      registerUser,\n      logout,\n      updateUser,\n      registerPreviousPage,\n      returnPreviousPage\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 117,\n    columnNumber: 5\n  }, this);\n};\n\n_s(AuthProvider, \"VitHbtE6eU/Lmv00UrJU65DNGfE=\", false, function () {\n  return [useHistory];\n});\n\n_c = AuthProvider;\nexport const useAuth = () => {\n  _s2();\n\n  return useContext(AuthContext);\n};\n\n_s2(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"sources":["/home/rodhardt/Documents/Q2/new-dihome/dihome-capstone-q2g2/src/providers/Authentication/index.tsx"],"names":["createContext","useContext","useState","useHistory","api","AuthContext","AuthProvider","children","history","authToken","setAuthToken","localStorage","getItem","userId","setUserId","userInfo","setUserInfo","previousPage","setPreviousPage","authenticate","get","headers","Authorization","then","response","data","catch","err","console","log","location","pathname","push","returnPreviousPage","signIn","userSignInData","post","setItem","accessToken","user","id","registerUser","userData","logout","clear","updateUser","newUserData","patch","registerPreviousPage","useAuth"],"mappings":"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","sourcesContent":["import { createContext, useContext, useState, ReactNode } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport api from \"../../services/api\";\nimport { UserData } from \"../../assets/Types/user\";\n\ninterface AuthProviderProps {\n  children: ReactNode;\n}\n\ninterface UserSignInData {\n  email: string;\n  password: string;\n}\n\ninterface AuthProviderData {\n  authToken: string;\n  userInfo: UserData;\n  authenticate: () => void;\n  signIn: (UserSignInData: UserSignInData) => void;\n  registerUser: (userData: UserData) => void;\n  logout: () => void;\n  updateUser: (userData: UserData) => void;\n  registerPreviousPage: () => void;\n  returnPreviousPage: () => void;\n}\n\nconst AuthContext = createContext<AuthProviderData>({} as AuthProviderData);\n\nexport const AuthProvider = ({ children }: AuthProviderProps) => {\n  const history = useHistory();\n\n  const [authToken, setAuthToken] = useState<string>(\n    () => localStorage.getItem(\"@dihome:token\") || \"\"\n  );\n\n  const [userId, setUserId] = useState<string>(\n    () => localStorage.getItem(\"@dihome:id\") || \"\"\n  );\n\n  const [userInfo, setUserInfo] = useState<UserData>({} as UserData);\n\n  const [previousPage, setPreviousPage] = useState<string>(\"/\");\n\n  const authenticate = () => {\n    if (authToken !== \"\") {\n      api\n        .get(`/users/${userId}`, {\n          headers: { Authorization: `Bearer ${authToken}` },\n        })\n        .then((response) => {\n          setUserInfo(response.data);\n        })\n        .catch((err) => console.log(err));\n    }\n    if (history.location.pathname === \"/perfil\" && authToken === \"\") {\n      setPreviousPage(\"/perfil\");\n      history.push(\"/login\");\n    }\n  };\n\n  const returnPreviousPage = () => {\n    history.push(previousPage);\n  };\n\n  const signIn = (userSignInData: UserSignInData) => {\n    api\n      .post(\"/signin\", userSignInData)\n      .then((response) => {\n        localStorage.setItem(\"@dihome:token\", response.data.accessToken);\n        localStorage.setItem(\"@dihome:id\", response.data.user.id);\n        setAuthToken(response.data.accessToken);\n        setUserInfo(response.data.user);\n        setUserId(response.data.user.id);\n        history.push(previousPage);\n      })\n      .catch((err) => console.log(err));\n  };\n\n  const registerUser = (userData: UserData) => {\n    api\n      .post(\"/register\", userData)\n      .then((response) => {\n        localStorage.setItem(\"@dihome:token\", response.data.accessToken);\n        localStorage.setItem(\"@dihome:id\", response.data.user.id);\n        setAuthToken(response.data.accessToken);\n        setUserInfo(response.data.user);\n        setUserId(response.data.user.id);\n        history.push(previousPage);\n      })\n      .catch((err) => console.log(err));\n  };\n\n  const logout = () => {\n    localStorage.clear();\n    setAuthToken(\"\");\n    setUserInfo({} as UserData);\n    history.push(\"/\");\n  };\n\n  const updateUser = (newUserData: UserData) => {\n    console.log(newUserData);\n    console.log(authToken);\n    console.log(userId);\n    setUserInfo(newUserData);\n    api\n      .patch(`/users/${userId}`, newUserData, {\n        headers: { Authorization: `Bearer ${authToken}` },\n      })\n      .catch((err) => console.log(err));\n  };\n\n  const registerPreviousPage = () => {\n    setPreviousPage(`${history.location.pathname}`);\n  };\n\n  return (\n    <AuthContext.Provider\n      value={{\n        authToken,\n        userInfo,\n        authenticate,\n        signIn,\n        registerUser,\n        logout,\n        updateUser,\n        registerPreviousPage,\n        returnPreviousPage,\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport const useAuth = () => useContext(AuthContext);\n"]},"metadata":{},"sourceType":"module"}