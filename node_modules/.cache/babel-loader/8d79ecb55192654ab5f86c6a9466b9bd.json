{"ast":null,"code":"var _jsxFileName = \"/home/rodhardt/Documents/Q2/new-dihome/dihome-capstone-q2g2/src/providers/Authentication/index.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport { createContext, useContext, useState } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport api from \"../../services/api\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext({});\nexport const AuthProvider = ({\n  children\n}) => {\n  _s();\n\n  const history = useHistory();\n  const [authToken, setAuthToken] = useState(() => localStorage.getItem(\"@dihome:token\") || \"\");\n  const [userId, setUserId] = useState(() => localStorage.getItem(\"@dihome:id\") || \"\");\n  const [userInfo, setUserInfo] = useState({});\n  const [previousPage, setPreviousPage] = useState(\"/\");\n\n  const authenticate = () => {\n    if (authToken.length > 0) {\n      api.get(`/users/${userId}`, {\n        headers: {\n          Authorization: `Bearer ${authToken}`\n        }\n      }).then(response => {\n        setUserInfo({\n          id: response.data.id,\n          name: response.data.name,\n          email: response.data.email,\n          telephone: response.data.telephone,\n          consultant: response.data.consultant,\n          announcedProperties: response.data.announcedProperties,\n          bookmarkedProperties: response.data.bookmarkedProperties,\n          subscriptionType: response.data.subscriptionType\n        });\n      }).catch(err => {\n        console.log(err);\n\n        if (history.location.pathname === \"/perfil\") {\n          setPreviousPage(\"/perfil\");\n          history.push(\"/login\");\n        }\n      });\n    }\n\n    if (history.location.pathname === \"/perfil\" && authToken === \"\") {\n      setPreviousPage(\"/perfil\");\n      history.push(\"/login\");\n    }\n  };\n\n  const returnPreviousPage = () => {\n    history.push(previousPage);\n  };\n\n  const signIn = userSignInData => {\n    api.post(\"/signin\", userSignInData).then(response => {\n      localStorage.setItem(\"@dihome:token\", response.data.accessToken);\n      localStorage.setItem(\"@dihome:id\", response.data.user.id);\n      setAuthToken(response.data.accessToken);\n      setUserInfo(response.data.user);\n      setUserId(response.data.user.id);\n      history.push(previousPage);\n    }).catch(err => console.log(err));\n  };\n\n  const registerUser = userData => {\n    api.post(\"/register\", userData).then(response => {\n      localStorage.setItem(\"@dihome:token\", response.data.accessToken);\n      localStorage.setItem(\"@dihome:id\", response.data.user.id);\n      setAuthToken(response.data.accessToken);\n      setUserInfo(response.data.user);\n      setUserId(response.data.user.id);\n      history.push(previousPage);\n    }).catch(err => console.log(err));\n  };\n\n  const logout = () => {\n    localStorage.clear();\n    setAuthToken(\"\");\n    setUserInfo({});\n    history.push(\"/\");\n  };\n\n  const updateUser = newUserData => {\n    setUserInfo(newUserData);\n    api.patch(`/users/${userId}`, newUserData, {\n      headers: {\n        Authorization: `Bearer ${authToken}`\n      }\n    }).then(response => console.log(response)).catch(err => console.log(err));\n  };\n\n  const registerPreviousPage = () => {\n    setPreviousPage(`${history.location.pathname}`);\n  };\n\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      authToken,\n      userInfo,\n      authenticate,\n      signIn,\n      registerUser,\n      logout,\n      updateUser,\n      registerPreviousPage,\n      returnPreviousPage\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 131,\n    columnNumber: 5\n  }, this);\n};\n\n_s(AuthProvider, \"VitHbtE6eU/Lmv00UrJU65DNGfE=\", false, function () {\n  return [useHistory];\n});\n\n_c = AuthProvider;\nexport const useAuth = () => {\n  _s2();\n\n  return useContext(AuthContext);\n};\n\n_s2(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"sources":["/home/rodhardt/Documents/Q2/new-dihome/dihome-capstone-q2g2/src/providers/Authentication/index.tsx"],"names":["createContext","useContext","useState","useHistory","api","AuthContext","AuthProvider","children","history","authToken","setAuthToken","localStorage","getItem","userId","setUserId","userInfo","setUserInfo","previousPage","setPreviousPage","authenticate","length","get","headers","Authorization","then","response","id","data","name","email","telephone","consultant","announcedProperties","bookmarkedProperties","subscriptionType","catch","err","console","log","location","pathname","push","returnPreviousPage","signIn","userSignInData","post","setItem","accessToken","user","registerUser","userData","logout","clear","updateUser","newUserData","patch","registerPreviousPage","useAuth"],"mappings":"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","sourcesContent":["import { createContext, useContext, useState, ReactNode } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport api from \"../../services/api\";\nimport { UserData } from \"../../assets/Types/user\";\n\ninterface AuthProviderProps {\n  children: ReactNode;\n}\n\ninterface UserSignInData {\n  email: string;\n  password: string;\n}\n\ninterface AuthProviderData {\n  authToken: string;\n  userInfo: UserData;\n  authenticate: () => void;\n  signIn: (UserSignInData: UserSignInData) => void;\n  registerUser: (userData: UserData) => void;\n  logout: () => void;\n  updateUser: (userData: UserData) => void;\n  registerPreviousPage: () => void;\n  returnPreviousPage: () => void;\n}\n\nconst AuthContext = createContext<AuthProviderData>({} as AuthProviderData);\n\nexport const AuthProvider = ({ children }: AuthProviderProps) => {\n  const history = useHistory();\n\n  const [authToken, setAuthToken] = useState<string>(\n    () => localStorage.getItem(\"@dihome:token\") || \"\"\n  );\n\n  const [userId, setUserId] = useState<string>(\n    () => localStorage.getItem(\"@dihome:id\") || \"\"\n  );\n\n  const [userInfo, setUserInfo] = useState<UserData>({} as UserData);\n\n  const [previousPage, setPreviousPage] = useState<string>(\"/\");\n\n  const authenticate = () => {\n    if (authToken.length > 0) {\n      api\n        .get(`/users/${userId}`, {\n          headers: { Authorization: `Bearer ${authToken}` },\n        })\n        .then((response) => {\n          setUserInfo({\n            id: response.data.id,\n            name: response.data.name,\n            email: response.data.email,\n            telephone: response.data.telephone,\n            consultant: response.data.consultant,\n            announcedProperties: response.data.announcedProperties,\n            bookmarkedProperties: response.data.bookmarkedProperties,\n            subscriptionType: response.data.subscriptionType,\n          });\n        })\n        .catch((err) => {\n          console.log(err);\n          if (history.location.pathname === \"/perfil\") {\n            setPreviousPage(\"/perfil\");\n            history.push(\"/login\");\n          }\n        });\n    }\n    if (history.location.pathname === \"/perfil\" && authToken === \"\") {\n      setPreviousPage(\"/perfil\");\n      history.push(\"/login\");\n    }\n  };\n\n  const returnPreviousPage = () => {\n    history.push(previousPage);\n  };\n\n  const signIn = (userSignInData: UserSignInData) => {\n    api\n      .post(\"/signin\", userSignInData)\n      .then((response) => {\n        localStorage.setItem(\"@dihome:token\", response.data.accessToken);\n        localStorage.setItem(\"@dihome:id\", response.data.user.id);\n        setAuthToken(response.data.accessToken);\n        setUserInfo(response.data.user);\n        setUserId(response.data.user.id);\n        history.push(previousPage);\n      })\n      .catch((err) => console.log(err));\n  };\n\n  const registerUser = (userData: UserData) => {\n    api\n      .post(\"/register\", userData)\n      .then((response) => {\n        localStorage.setItem(\"@dihome:token\", response.data.accessToken);\n        localStorage.setItem(\"@dihome:id\", response.data.user.id);\n        setAuthToken(response.data.accessToken);\n        setUserInfo(response.data.user);\n        setUserId(response.data.user.id);\n        history.push(previousPage);\n      })\n      .catch((err) => console.log(err));\n  };\n\n  const logout = () => {\n    localStorage.clear();\n    setAuthToken(\"\");\n    setUserInfo({} as UserData);\n    history.push(\"/\");\n  };\n\n  const updateUser = (newUserData: UserData) => {\n    setUserInfo(newUserData);\n\n    api\n      .patch(`/users/${userId}`, newUserData, {\n        headers: { Authorization: `Bearer ${authToken}` },\n      })\n      .then((response) => console.log(response))\n      .catch((err) => console.log(err));\n  };\n\n  const registerPreviousPage = () => {\n    setPreviousPage(`${history.location.pathname}`);\n  };\n\n  return (\n    <AuthContext.Provider\n      value={{\n        authToken,\n        userInfo,\n        authenticate,\n        signIn,\n        registerUser,\n        logout,\n        updateUser,\n        registerPreviousPage,\n        returnPreviousPage,\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport const useAuth = () => useContext(AuthContext);\n"]},"metadata":{},"sourceType":"module"}